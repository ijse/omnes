<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Hello Omnes</title>
		<style type="text/css">
			#loading {
				height: 100px;
				margin: 100px 200px;			
				font-size: 32px;
				font-weight: bold;
			}
		</style>
		<link rel="stylesheet" type="text/css" href="resources/css/main.css" />
		<link rel="stylesheet" type="text/css" href="extjs/resources/css/ext-all.css" />
	</head>
	<body>
		<!-- Login and Signin Box  -->
		<div id="auth-wrap">
			<div class="loginBox">
				<p><label for="login-uname">UserName:</label><input type="text" id="login-uname"></p>
				<p><label for="login-upass">PassWord:</label><input type="text" id="login-upass"></p>
				<div><input type="button" value="login" id="login-go"></div>
			</div>
			<div class="signinBox">
				<p><label for="signin-uname">UserName:</label><input type="text" id="signin-uname"></p>
				<p><label for="signin-upass">PassWord:</label><input type="text" id="signin-upass"></p>
				<p><label for="signin-vpass">Verify Password:</label><input type="text" id="signin-vpass"></p>
				<p><label for="signin-email">Email:</label><input type="text" id="signin-email"></p>
				<div><input type="button" value="sigin" id="signin-go"></div>
			</div>
		</div>
		<script src="XHCon.js"></script>
		<script> 
			(function() {
				
				var $$= function() {
					return document.getElementById.apply(document, arguments);
				};
				$$("signin-go").onclick = function() {
					var xhrCon = new XHConn();
					// Get form data
					var obj = {
						name: $$("signin-uname").value,
						pass: $$("signin-upass").value,
						pass2: $$("signin-vpass").value,
						email: $$("signin-email").value
					};
					var p = params(obj);
					console.log(obj, p);
					// Validate
					xhrCon.connect("/user/signin", "POST", p, function(rp) {
						var data = eval("(" + rp.responseText + ")");
						if(data.success == true) {
							// Sigin in success, login
							// Try to initApp() until it loaded up!
							var t = setInterval(function() {
								if(window.initApp) {
									clearInterval(t);
									window.initApp();
								}
							}, 500);
						} else {
							// Fail
							alert("Signin Fail!!");
						}
					});
				}
				$$("login-go").onclick = function() {
					var xhrCon = new XHConn();
					var obj = {
						name: $$("login-uname").value,
						pass: $$("login-upass").value
					};
					var p = params(obj);
					xhrCon.connect("/user/login", "POST", p, function(rp) {
						console.log(rp.responseText);
						var data = eval("(" + rp.responseText + ")");
						if(data.success == true) {
							$$("auth-wrap").innerHTML="";
							var t = setInterval(function() {
								if(window.initApp) {
									clearInterval(t);
									window.initApp();
								}
							}, 500);
						} else {
							// Fail
							alert("Login Fail!!");
						}
					});
				}

				function params(obj) {
					var i, r="";
					for(i in obj) {
						var v = obj[i];
						r = r + i + "=" + v + "&";
					}
					return r.replace(/&$/, "");
				}

			})()
		 </script>
		<!-- End Signin or Login -->

		<div id="loading">
			<span>Loading <i id="loading-text">stylesheet</i>...</span>
		</div>

		<script type="text/javascript">
			document.getElementById("loading-text").innerText = "extjs lib";
		</script>
		
    	<script src="extjs/ext-debug.js"></script>

    	<script type="text/javascript">
			document.getElementById("loading-text").innerText = "app";
		</script>
    	<script src="app.js"></script>
	</body>
</html>